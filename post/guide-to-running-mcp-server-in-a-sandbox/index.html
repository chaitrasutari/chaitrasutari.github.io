<!DOCTYPE html><p>MCP is a hot protocol in the AI development industry this year, but its Client/Server (C/S) architecture requires users to run the MCP Server locally.</p>
<p>Common ways to run MCP Server include stdio methods like npx (NPM ecosystem), uvx (Python ecosystem), Docker, and HTTP (SSE/Streaming) methods. However, running commands with npx and uvx carries significant risks. Accidentally executing a malicious package could lead to sensitive data exposure, posing a major security threat. For details, you can refer to Invariant’s article <a href="https://invariantlabs.ai/blog/mcp-security-notification-tool-poisoning-attacks">MCP Security Notification: Tool Poisoning Attacks</a>.</p>
<p>As a software industry professional, I have a high degree of concern for security. I asked ChatGPT to compile a list of NPM and PyPI supply chain attack incidents from the past 5 years, and it was chilling.</p>






































































<table><thead><tr><th><strong>Time</strong></th><th><strong>Event</strong></th><th><strong>Summary and Scope of Impact</strong></th></tr></thead><tbody><tr><td><strong>February 2021</strong></td><td><strong>”Dependency Confusion” Vulnerability Disclosure</strong></td><td>Security researcher Alex Birsan utilized the <strong>Dependency Confusion</strong> technique to upload packages to NPM/PyPI with the same names as internal libraries used by multiple companies, successfully infiltrating the internal servers of 35 major companies including Apple and Microsoft (<a href="https://www.sonatype.com/blog/pypi-flooded-with-over-1200-dependency-confusion-packages#:~:text=Dependency%20confusion%3A%20Year%20in%20review">PyPI flooded with 1,275 dependency confusion packages</a>). This demonstration sparked high concern within the industry regarding supply chain risks.</td></tr><tr><td><strong>October 2021</strong></td><td><strong>UAParser.js Library Hijacked</strong></td><td>The popular library <em>ua-parser-js</em> on NPM, with over 7 million weekly downloads, was compromised by attackers via the maintainer’s account to publish malicious versions (<a href="https://www.sonatype.com/resources/vulnerability-timeline#:~:text=%23%23%20%20Popular%20%22ua,Attacked">A Timeline of SSC Attacks, Curated by Sonatype</a>). Infected versions implanted <strong>password-stealing trojans</strong> and <strong>cryptocurrency miners</strong> upon installation, affecting a large number of developer systems.</td></tr><tr><td><strong>October 2021</strong></td><td><strong>Poisoning via Fake Roblox Libraries</strong></td><td>Attackers uploaded multiple packages impersonating Roblox API on NPM (e.g., <em>noblox.js-proxy</em>), containing obfuscated malicious code. These packages would implant <strong>trojans and ransomware</strong> payloads after installation (<a href="https://www.sonatype.com/resources/vulnerability-timeline#:~:text=,and%20has%20a%20Spooky%20Surprise">A Timeline of SSC Attacks, Curated by Sonatype</a>). These packages were downloaded thousands of times, demonstrating attackers used <strong>typosquatting</strong> to trick game developers.</td></tr><tr><td><strong>November 2021</strong></td><td><strong>COA and RC Libraries Successively Hijacked</strong></td><td>Popular libraries on NPM, <em>coa</em> (millions of weekly downloads) and <em>rc</em> (14 million weekly downloads), were successively compromised to publish malicious versions. The affected versions executed <strong>credential-stealing trojans</strong> similar to the UAParser.js case, at one point causing build pipelines to break for numerous projects globally using frameworks like React (<a href="https://www.sonatype.com/resources/vulnerability-timeline#:~:text=,js">A Timeline of SSC Attacks, Curated by Sonatype</a>) (<a href="https://www.sonatype.com/resources/vulnerability-timeline#:~:text=,Is%20Hijacked%2C%20Too">A Timeline of SSC Attacks, Curated by Sonatype</a>). Official investigations determined the cause in both cases was compromised maintainer accounts.</td></tr><tr><td><strong>January 2022</strong></td><td><strong>Colors/Faker Open Source Libraries “Suicide”</strong></td><td>The authors of the famous color formatting library <em>colors.js</em> and test data generation library <em>faker.js</em>, out of protest, injected destructive code like infinite loops in the latest versions, causing thousands of projects, including those at companies like Meta (Facebook) and Amazon, to crash (<a href="https://www.sonatype.com/resources/vulnerability-timeline#:~:text=Thousands%20of%20open%20source%20projects,companies%20exploiting%20open%20source">A Timeline of SSC Attacks, Curated by Sonatype</a>) (While not an external attack, it falls within the scope of supply chain poisoning).</td></tr><tr><td><strong>January 2022</strong></td><td><strong>PyPI: 1,275 Malicious Packages Deployed in Bulk</strong></td><td>A single user frantically published <strong>1,275 malicious packages</strong> to PyPI in one day on January 23rd (<a href="https://www.sonatype.com/resources/vulnerability-timeline#:~:text=,Than%201%2C200%20Dependency%20Confusion%20Packages">A Timeline of SSC Attacks, Curated by Sonatype</a>). Most of these packages impersonated the names of well-known projects or companies (e.g., <em>xcryptography</em>, <em>Sagepay</em>, etc.). After installation, they collected fingerprint information like hostname, IP, etc., and exfiltrated it to the attackers via DNS/HTTP (<a href="https://www.sonatype.com/blog/pypi-flooded-with-over-1200-dependency-confusion-packages#:~:text=The%20,of%20these%20components%20are%20installed">PyPI flooded with 1,275 dependency confusion packages</a>) (<a href="https://www.sonatype.com/blog/pypi-flooded-with-over-1200-dependency-confusion-packages#:~:text=For%20DNS%3A%20.sub.deliverycontent,online">PyPI flooded with 1,275 dependency confusion packages</a>). PyPI administrators took down all related packages within an hour of receiving the report (<a href="https://www.sonatype.com/blog/pypi-flooded-with-over-1200-dependency-confusion-packages#:~:text=All%20of%20the%201%2C275%20were,an%20hour%20of%20our%20report">PyPI flooded with 1,275 dependency confusion packages</a>).</td></tr><tr><td><strong>March 2022</strong></td><td><strong>Node-ipc “Protestware” Incident</strong></td><td>The author of <em>node-ipc</em>, a commonly used front-end build library, added malicious code in versions v10.1.1–10.1.3: when detecting client IPs belonging to Russia or Belarus, it would <strong>wipe the file system</strong> and overwrite files with heart emojis ([Corrupted open-source software enters the Russian battlefield</td></tr><tr><td><strong>October 2022</strong></td><td><strong>LofyGang Large-Scale Poisoning Campaign</strong></td><td>Security companies discovered a group named “LofyGang” distributed nearly <strong>200 malicious packages</strong> on NPM (<a href="https://thehackernews.com/2022/10/lofygang-distributed-200-malicious-npm.html#:~:text=Multiple%20campaigns%20that%20distributed%20trojanized,single%20threat%20actor%20dubbed%20LofyGang">LofyGang Distributed ~200 Malicious NPM Packages to Steal Credit Card Data</a>). These packages implanted <strong>trojans</strong> through <strong>typosquatting</strong> and by impersonating common library names, stealing developers’ credit card information, Discord accounts, and game service login credentials, accumulating thousands of installations (<a href="https://thehackernews.com/2022/10/lofygang-distributed-200-malicious-npm.html#:~:text=Multiple%20campaigns%20that%20distributed%20trojanized,single%20threat%20actor%20dubbed%20LofyGang">LofyGang Distributed ~200 Malicious NPM Packages to Steal Credit Card Data</a>). This was an organized cybercrime activity that lasted over a year.</td></tr><tr><td><strong>December 2022</strong></td><td><strong>PyTorch-nightly Dependency Chain Attack</strong></td><td>Well-known deep learning framework PyTorch disclosed that its nightly version suffered a <strong>dependency confusion</strong> supply chain attack between December 25-30 ([Malicious PyTorch dependency ‘torchtriton’ on PyPI</td></tr><tr><td><strong>March 2023</strong></td><td><strong>”W4SP Stealer” Trojan Rampant on PyPI</strong></td><td>Security researchers successively discovered a large number of malicious packages carrying the <strong>W4SP Stealer</strong> information-stealing trojan appearing on PyPI (<a href="https://thehackernews.com/2022/12/w4sp-stealer-discovered-in-multiple.html#:~:text=Threat%20actors%20have%20published%20yet,malware%20on%20compromised%20developer%20machines">W4SP Stealer Discovered in Multiple PyPI Packages Under Various Names</a>). These trojans have many aliases (e.g., ANGEL Stealer, PURE Stealer, etc.) but essentially all belong to the W4SP family, specifically designed to steal information like user passwords, cryptocurrency wallets, and Discord tokens (<a href="https://thehackernews.com/2022/12/w4sp-stealer-discovered-in%20multiple.html#:~:text=Interestingly%2C%20while%20the%20malware%20goes,be%20copies%20of%20W4SP%20Stealer">W4SP Stealer Discovered in Multiple PyPI Packages Under Various Names</a>). A single report revealed 16 such malicious packages (e.g., <em>modulesecurity</em>, <em>easycordey</em>, etc.) (<a href="https://thehackernews.com/2022/12/w4sp-stealer-discovered-in-multiple.html#:~:text=The%2016%20rogue%20modules%20are,nowsys%2C%20upamonkws%2C%20captchaboy%2C%20and%20proxybooster">W4SP Stealer Discovered in Multiple PyPI Packages Under Various Names</a>). PyPI initiated a cleanup targeting such trojans and strengthened upload detection.</td></tr><tr><td><strong>August 2023</strong></td><td><strong>Lazarus Group Attacks PyPI</strong></td><td>ReversingLabs reported that a branch of the North Korean hacking group Lazarus published over two dozen (more than 24) malicious packages disguised as popular libraries on PyPI (codenamed “VMConnect” operation) (<a href="https://www.reversinglabs.com/blog/a-partial-history-of-software-supply-chain-attacks#:~:text=">Software Supply Chain Attacks: A (partial) History</a>). These packages attempted to target users in specific industries (e.g., finance) to implant remote access trojans. It is claimed this attack is linked to previous similar activities targeting NuGet, showing state-sponsored hackers’ interest in the open-source supply chain.</td></tr><tr><td><strong>2024 and Beyond</strong></td><td><strong>Ongoing Supply Chain Threats</strong></td><td>Since 2024, new poisoning incidents continue to emerge on NPM and PyPI. For example, in early 2024, fake VS Code-related NPM packages were found to contain remote control spyware (<a href="https://www.sonatype.com/resources/vulnerability-timeline#:~:text=,altered%20ScreenConnect%20utility%20as%20spyware">A Timeline of SSC Attacks, Curated by Sonatype</a>), and PyPI packages impersonating Solana libraries to steal crypto wallet keys (<a href="https://www.sonatype.com/resources/vulnerability-timeline#:~:text=%23%23%20%20Ideal%20typosquat%20%27solana,steals%20your%20crypto%20wallet%20keys">A Timeline of SSC Attacks, Curated by Sonatype</a>) were discovered. This indicates that supply chain attacks have become a normalized threat, requiring the ecosystem to continuously raise vigilance and defense capabilities.</td></tr></tbody></table>
<p>I complained a bit on Twitter, and while complaining, I saw a tweet from a friend who had just encountered a supply chain attack incident.</p>
<p><a href="https://x.com/tcdwww/status/1914202659210359108"><img src="https://static.miantiao.me/share/ZUy0MY/twitter.jpeg" alt="Twitter"></a></p>
<p>Fortunately, <a href="https://x.com/TBXark">@TBXark</a> recommended his <strong>MCP Proxy</strong> project, which makes it very convenient to run MCP Server in Docker. His initial goal was to run MCP Server on a server to reduce client load and facilitate mobile client calls. However, Docker’s inherent isolation features perfectly aligned with my requirement for a sandbox.</p>
<p>MCP Proxy runs MCP Servers in Docker and converts the protocol to MCP SSE, allowing users to make all calls via the SSE protocol from the MCP client. This can significantly reduce the risk of arbitrary file reading caused by directly running npx and uvx. <em>If deployed on an overseas server, it can also help solve network issues.</em></p>
<p>However, it is currently still possible to read the <code>/config/config.json</code> configuration file of MCP Proxy, but the risk is manageable. I have also raised a feature request with the developer to configure the config file with 400 permissions and run the npx and uvx commands as the nobody user. If this can be implemented, it will perfectly solve the arbitrary file reading issue.</p>
<h2 id="running-mcp-proxy">Running MCP Proxy</h2>
<p><a href="https://github.com/TBXark/mcp-proxy"><img src="https://github.html.zone/TBXark/mcp-proxy" alt="MCP Proxy"></a></p>
<p>If you have your own VPS with Docker deployed, you can use the following command to run MCP Proxy.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>docker run -d -p 9090:9090 -v /path/to/config.json:/config/config.json ghcr.io/tbxark/mcp-proxy:latest</span></span></code></pre>
<p>If you don’t have your own VPS, you can use the free container service provided by <a href="https://404.li/claw"><strong>claw.cloud</strong></a> ($5 credit per month, GitHub registration must be older than 180 days).</p>
<p>Since Claw has container size limitations, we need to use the following environment variables to configure the cache directories for npx and uvx to prevent container crashes.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>UV_CACHE_DIR=/cache/uv</span></span>
<span class="line"><span>npm_config_cache=/cache/npm</span></span></code></pre>
<p>Simultaneously mount 10GB of storage under the <code>/cache</code> path. Refer to my configuration: 0.5c CPU, 512M Memory, 10G Disk.</p>
<p>The final configuration is as follows:</p>
<p><img src="https://static.miantiao.me/share/g4KUgP/claw.jpg" alt="Claw"></p>
<h2 id="configuring-mcp-proxy">Configuring MCP Proxy</h2>
<p>The configuration file needs to be mounted at the <code>/config/config.json</code> path. For the complete configuration, please refer to <a href="https://github.com/TBXark/mcp-proxy?tab=readme-ov-file#configurationonfiguration">https://github.com/TBXark/mcp-proxy?tab=readme-ov-file#configurationonfiguration</a>.</p>
<p>Below is my configuration, for your reference.</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="json"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#79B8FF">    "mcpProxy"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">        "baseURL"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"https://mcp.miantiao.me"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        "addr"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">":9090"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        "name"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"MCP Proxy"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        "version"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"1.0.0"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">        "options"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">          "panicIfInvalid"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">          "logEnabled"</span><span style="color:#E1E4E8">: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">          "authTokens"</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">            "miantiao.me"</span></span>
<span class="line"><span style="color:#E1E4E8">          ]</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    },</span></span>
<span class="line"><span style="color:#79B8FF">    "mcpServers"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">        "github"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">            "command"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"npx"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">            "args"</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">                "-y"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">                "@modelcontextprotocol/server-github"</span></span>
<span class="line"><span style="color:#E1E4E8">            ],</span></span>
<span class="line"><span style="color:#79B8FF">            "env"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">                "GITHUB_PERSONAL_ACCESS_TOKEN"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"&#x3C;YOUR_TOKEN>"</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#79B8FF">        "fetch"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">            "command"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"uvx"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">            "args"</span><span style="color:#E1E4E8">: [</span></span>
<span class="line"><span style="color:#9ECBFF">                "mcp-server-fetch"</span></span>
<span class="line"><span style="color:#E1E4E8">            ]</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#79B8FF">        "amap"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">            "url"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"https://mcp.amap.com/sse?key=&#x3C;YOUR_TOKEN>"</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="calling-mcp-proxy">Calling MCP proxy</h2>
<p>Taking <a href="https://404.li/chatwise"><strong>ChatWise</strong></a> calling fetch as an example, just configure the SSE protocol directly.</p>
<p><img src="https://static.miantiao.me/share/mI3zIh/fetch.jpg" alt="fetch"></p>
<p>Isn’t it simple? When <a href="https://404.li/chatwise"><strong>ChatWise</strong></a> releases its mobile version, calling it this way will also be fully usable.</p>
<p><img src="https://static.miantiao.me/share/t43O9e/chatwise.jpg" alt="ChatWise"></p>